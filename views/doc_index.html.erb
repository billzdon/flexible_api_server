<html>

  <head>
    <style type="text/css">
      * { font-family: 'Helvetica', sans-serif; }
      body { background: #ddd; text-align: center; }
      .model { background: #fff; padding: 20px; border-bottom: 2px solid #333; margin-bottom: 20px }
      .model_name { font-size: 42px; margin: 20px 20px 15px 20px; text-shadow: 2px 2px #ccc; }
      #wrapper { margin: 30px auto 20px auto; text-align: left; width: 890px }
      .request_level { margin-bottom: 10px; }
      .request_level .includes { padding: 0px 10px 0px 10px }
      .includes .include { background: #ddd !important; }
      .include .name, .include .type, .include .request_level { display: inline-block; }
      .include .request_level_name { color: #777 !important; display: inline-block; }
      .includes .include, .fields .notation, .fields .field { display: inline-block; border: 1px solid #aaa; margin: 0px 10px 10px 0px; background: #eee; padding: 5px 10px; }
      .fields .notation { color: #990000; } 
      .fields .field { color: #000099; }
      .request_level .level_name, .request_level .level_name:visited { display: block; font-size: 24px; padding: 5px 10px; border-bottom: 1px solid #aaa; color: #000099; text-shadow: 1px 1px #aaa; }
      .request_level .fields { padding: 10px 10px 0px 10px; }
      .associations { font-size: 24px; color: #336633; } 
      .scopes { font-size: 24px; margin-top: 10px; color: #663333; }
      .associations .association, .scopes .scope { border-bottom: 1px solid #aaa; padding: 5px 10px; text-shadow: 1px 1px #aaa }
      .field .label, .notation .label { }
      .field .description, .notation .description, .include .description { font-size: 12px; color: #333 }
      #intro { margin-bottom: 10px; padding: 10px; font-size: 24px; color: #aaa; }
    </style>
  </head>

  <body>

    <div id="wrapper">

      <div id="intro">
        This documentation was automatically generated by <em>FlexibleApi</em> as a guide to the available calls and options.
      </div>

      <% @model_details.each do |model| %>

        <% model_type = model.name.pluralize.underscore.downcase %>

        <div class="model_name">/<%= model_type %></div>
        <div class="model">

          <div class="request_levels">
    
            <% levels = model.request_levels << nil %>
            <% levels.each do |level_name| %>

              <% detail = model.find_level(level_name).to_hash %>

              <div class="request_level">
                <a href="#" class="level_name">?level=<%= detail[:name] %></a>
                <a class="details">

                  <div class="fields">
                    <% (detail[:fields]).each do |field| %>
                      <% desc = @copy[model_type]['fields'][field.to_s] if @copy && @copy[model_type] && @copy[model_type]['fields'] %>
                      <div class="field">
                        <div class="label"><%= field %></div>
                        <div class="description"><%= desc || 'No description' %></div>
                      </div>
                    <% end %>
                  </div>

                  <div class="includes">
                    <% detail[:includes].each do |inc| %>
                      <% desc = @copy[model_type]['includes'][inc[:name].to_s] if @copy && @copy[model_type] && @copy[model_type]['includes'] %>
                      <div class="include">
                        <div class="name"><%= inc[:name] %></div>
                        <% unless inc[:type] == inc[:name] %>
                          <div class="type"><%= "[#{inc[:type]}]" %></div>
                        <% end %>
                        <div class="request_level_name"><%= "(:#{inc[:request_level]})" %></div>
                        <div class="description"><%= desc || 'No description' %></div>
                      </div>
                  <% end %>
                </div>

              </a>
            </div>

          <% end %>

          <% unless model.scopes.empty? %>
            <div class="scopes">
              <% model.scopes.each do |scope| %>
                <div class="scope"><%= "?scopes[]=#{scope}" %></div>
              <% end %>
            </div>
          <% end %>

          <% unless true || model[:associations].empty? %>
            <div class="associations">
              <% model[:associations].each do |assoc| %>
                <div class="association">
                  <%= "/#{assoc[:name]}" %>
                  <% unless assoc[:name].to_s == assoc[:type] %>
                    <%= "(type: #{assoc[:type]})" %>
                  <% end %>
                </div>
              <% end %>
            </div>
          <% end %>
        
        </div>
      
      </div>

    <% end %>

  </body>

</html>
